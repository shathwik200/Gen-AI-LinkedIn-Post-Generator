<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gen AI LinkedIn Post Generator</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body {
      background: linear-gradient(135deg, #ece9e6, #ffffff);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      margin-top: 4rem;
    }
    .modern-card {
      border: none;
      border-radius: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 2rem;
      background-color: #fff;
    }
    .copy-btn, .edit-btn, .new-btn, .save-btn {
      margin-top: 1rem;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #333;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="text-center mb-5">
      <h1 class="fw-bold animate__animated animate__fadeInDown">Gen AI LinkedIn Post Generator</h1>
      <p class="lead animate__animated animate__fadeInUp">Unleash your ideas into dynamic, modern posts!</p>
    </div>
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="modern-card animate__animated animate__fadeIn">
          <form id="postForm">
            <div class="mb-3">
              <label for="idea" class="form-label">Enter your idea:</label>
              <textarea class="form-control" id="idea" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100" id="generateBtn">
              <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
              Generate Post
            </button>
          </form>
          <div id="result" class="mt-4"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="copyToast">Post copied to clipboard!</div>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- jQuery (for AJAX) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#postForm').on('submit', function(event) {
        event.preventDefault();
        const idea = $('#idea').val();
        const spinner = $('.spinner-border');
        const generateBtn = $('#generateBtn');
        $('#result').empty(); // Clear previous results

        spinner.removeClass('d-none');
        generateBtn.prop('disabled', true);

        $.ajax({
          url: '/generate_post',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ idea: idea }),
          success: function(response) {
            $('#result').html('<div class="alert alert-success animate__animated animate__fadeIn">Post generated successfully!</div>');
            $.ajax({
              url: '/get_post',
              method: 'GET',
              success: function(postData) {
                // Convert literal "\n" in the text to actual new lines for display
                const formattedText = postData.text.replace(/\\n/g, '<br>');
                const hashtagsHtml = postData.hashtag ? 
                  postData.hashtag.map(tag => `<span class="badge bg-secondary me-1 mb-1">${tag}</span>`).join('') : '';
                const postHtml = `
                  <div class="mt-4 modern-card animate__animated animate__fadeInUp" id="postCard">
                    <div id="postDisplay">
                      <p class="fs-5" id="postText">${formattedText}</p>
                    </div>
                    <div class="mt-3" id="hashtagsContainer">
                      ${hashtagsHtml}
                    </div>
                    <button class="btn btn-outline-secondary copy-btn" onclick="copyToClipboard()">Copy Post</button>
                    <button class="btn btn-outline-primary edit-btn" onclick="enableEditing()">Edit Post</button>
                    <button class="btn btn-outline-warning new-btn" onclick="generateNewPost()">Generate New Post</button>
                  </div>
                `;
                $('#result').append(postHtml);
              }
            });
          },
          error: function(xhr) {
            $('#result').html('<div class="alert alert-danger animate__animated animate__shakeX">' + xhr.responseJSON.error + '</div>');
          },
          complete: function() {
            spinner.addClass('d-none');
            generateBtn.prop('disabled', false);
          }
        });
      });
    });

    function copyToClipboard() {
      let postContent;
      if(document.getElementById('postText')){
        postContent = document.getElementById('postText').innerText;
      } else {
        postContent = document.querySelector('#postEdit').value;
      }
      const hashtags = Array.from(document.querySelectorAll('#hashtagsContainer .badge'))
        .map(el => el.innerText)
        .join(' ');
      const fullPost = postContent + '\n\n' + hashtags;
      
      navigator.clipboard.writeText(fullPost).then(() => {
        const toast = document.getElementById('copyToast');
        toast.style.display = 'block';
        setTimeout(() => {
          toast.style.display = 'none';
        }, 2000);
      });
    }

    function enableEditing() {
      const postDisplay = $('#postDisplay');
      const currentText = $('#postText').html().replace(/<br>/g, "\n");
      const editArea = `<textarea class="form-control" id="postEdit" rows="6">${currentText}</textarea>
                        <button class="btn btn-success save-btn mt-2" onclick="saveEdits()">Save Changes</button>`;
      postDisplay.html(editArea);
    }

    function saveEdits() {
      const updatedText = $('#postEdit').val();
      // When saving, convert actual new lines back to literal "\n"
      const savedText = updatedText.replace(/\n/g, '\\n');
      const newDisplay = `<p class="fs-5" id="postText">${savedText.replace(/\\n/g, '<br>')}</p>`;
      $('#postDisplay').html(newDisplay);
    }

    function generateNewPost() {
      // Clear result and idea field
      $('#result').empty();
      $('#idea').val('');
    }
  </script>
</body>
</html>
